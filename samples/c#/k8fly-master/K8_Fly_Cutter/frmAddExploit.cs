namespace K8_Fly_Cutter
{
    using BLL;
    using System;
    using System.ComponentModel;
    using System.Data;
    using System.Drawing;
    using System.Threading;
    using System.Windows.Forms;

    public class frmAddExploit : Form
    {
        private Button btn_AddExp;
        private ComboBox cbb_appName;
        private IContainer components = null;
        private string[] ExpModelArray;
        private string k8updateID;
        private Label label1;
        private Label label2;
        private Label label3;
        private frmMain paf;
        private TextBox txt_btnName;
        private TextBox txt_btnTip;

        public frmAddExploit(frmMain parent, string[] ModelArray, string k8id)
        {
            this.InitializeComponent();
            this.paf = parent;
            this.ExpModelArray = ModelArray;
            this.k8updateID = k8id;
            if (this.k8updateID == "")
            {
                this.btn_AddExp.Text = "添加EXP";
            }
            else
            {
                this.btn_AddExp.Text = "修改EXP";
            }
        }

        private void btn_AddExp_Click(object sender, EventArgs e)
        {
            string str = DateTime.Now.Date.ToShortDateString();
            if (str.Contains("/"))
            {
                str = str.Replace("/", "-");
            }
            this.ExpModelArray[0] = Thread.CurrentThread.CurrentCulture.TextInfo.ToTitleCase(this.cbb_appName.Text.Trim().ToLower());
            this.ExpModelArray[1] = this.txt_btnName.Text.Trim();
            this.ExpModelArray[2] = this.txt_btnTip.Text.Trim();
            this.paf.k8updateID = this.k8updateID;
            this.paf.k8appName = this.ExpModelArray[0];
            this.paf.k8btnName = this.ExpModelArray[1];
            this.paf.k8btnTip = this.ExpModelArray[2];
            this.ExpModelArray[1] = K8crack.K8expBase64(this.ExpModelArray[1], 1);
            this.ExpModelArray[2] = K8crack.K8expBase64(this.ExpModelArray[2], 1);
            this.ExpModelArray[10] = str;
            if (this.k8updateID == "")
            {
                string str2 = this.ExpModelArray[0];
                string str3 = this.ExpModelArray[3];
                string str4 = this.ExpModelArray[4];
                string str5 = this.ExpModelArray[5];
                string str6 = this.ExpModelArray[6];
                string str7 = this.ExpModelArray[7];
                string str8 = this.ExpModelArray[8];
                string str9 = this.ExpModelArray[9];
                string str10 = this.ExpModelArray[11];
                string[] modelArray = new string[] { str2, str3, str4, str5, str6, str7, str8, str9, str10 };
                if (BLLk8EXP.ExistsRecord(modelArray))
                {
                    this.K8msgbox("已存在相同EXP! 若要修改请到按扭上右键修改EXP.\r\n\r\n按钮名称：" + K8crack.K8expBase64(BLLk8EXP.ExistsRecordGetBtnName(modelArray), 0));
                }
                else if (BLLk8EXP.InsertRecord(this.ExpModelArray))
                {
                    this.paf.K8createTabExpBtn();
                    this.K8msgbox("添加EXP成功!");
                    base.Close();
                }
            }
            else if (BLLk8EXP.UpdateRecord(this.ExpModelArray, int.Parse(this.k8updateID)))
            {
                this.paf.K8createTabExpBtn();
                this.paf.btn_AddUpdateExp.Text = "添加EXP";
                this.paf.k8updateID = "";
                this.K8msgbox("修改EXP成功!");
                base.Close();
            }
        }

        protected override void Dispose(bool disposing)
        {
            if (disposing && (this.components != null))
            {
                this.components.Dispose();
            }
            base.Dispose(disposing);
        }

        private void frmAddExploit_Load(object sender, EventArgs e)
        {
            base.CenterToParent();
            base.MaximizeBox = false;
            base.MinimizeBox = false;
            this.LoadExpAppList();
            this.cbb_appName.Text = this.ExpModelArray[0];
            this.txt_btnName.Text = this.ExpModelArray[1];
            this.txt_btnTip.Text = this.ExpModelArray[2];
            this.btn_AddExp.Focus();
        }

        private void InitializeComponent()
        {
            ComponentResourceManager resources = new ComponentResourceManager(typeof(frmAddExploit));
            this.cbb_appName = new System.Windows.Forms.ComboBox();
            this.label1 = new System.Windows.Forms.Label();
            this.label2 = new System.Windows.Forms.Label();
            this.txt_btnName = new System.Windows.Forms.TextBox();
            this.txt_btnTip = new System.Windows.Forms.TextBox();
            this.label3 = new System.Windows.Forms.Label();
            this.btn_AddExp = new System.Windows.Forms.Button();
            base.SuspendLayout();
            this.cbb_appName.FormattingEnabled = true;
            this.cbb_appName.Items.AddRange(new object[] { "Discuz!", "Ecshop" });
            this.cbb_appName.Location = new Point(0x4d, 11);
            this.cbb_appName.Name = "cbb_appName";
            this.cbb_appName.Size = new Size(110, 20);
            this.cbb_appName.TabIndex = 0;
            this.label1.AutoSize = true;
            this.label1.Location = new Point(12, 14);
            this.label1.Name = "label1";
            this.label1.Size = new Size(0x3b, 12);
            this.label1.TabIndex = 1;
            this.label1.Text = "应用程序:";
            this.label2.AutoSize = true;
            this.label2.Location = new Point(12, 0x29);
            this.label2.Name = "label2";
            this.label2.Size = new Size(0x3b, 12);
            this.label2.TabIndex = 2;
            this.label2.Text = "按钮名称:";
            this.txt_btnName.Location = new Point(0x4d, 0x26);
            this.txt_btnName.Name = "txt_btnName";
            this.txt_btnName.Size = new Size(320, 0x15);
            this.txt_btnName.TabIndex = 3;
            this.txt_btnTip.Location = new Point(14, 0x53);
            this.txt_btnTip.Multiline = true;
            this.txt_btnTip.Name = "txt_btnTip";
            this.txt_btnTip.Size = new Size(0x17f, 0x60);
            this.txt_btnTip.TabIndex = 5;
            this.label3.AutoSize = true;
            this.label3.Location = new Point(12, 0x44);
            this.label3.Name = "label3";
            this.label3.Size = new Size(0x3b, 12);
            this.label3.TabIndex = 4;
            this.label3.Text = "按扭提示:";
            this.btn_AddExp.Location = new Point(0x139, 8);
            this.btn_AddExp.Name = "btn_AddExp";
            this.btn_AddExp.Size = new Size(0x54, 0x17);
            this.btn_AddExp.TabIndex = 0x4a;
            this.btn_AddExp.Text = "添加EXP";
            this.btn_AddExp.UseVisualStyleBackColor = true;
            this.btn_AddExp.Click += new EventHandler(this.btn_AddExp_Click);
            base.AutoScaleDimensions = new SizeF(6f, 12f);
            base.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            base.ClientSize = new Size(0x19b, 0xbf);
            base.Controls.Add(this.btn_AddExp);
            base.Controls.Add(this.txt_btnTip);
            base.Controls.Add(this.label3);
            base.Controls.Add(this.txt_btnName);
            base.Controls.Add(this.label2);
            base.Controls.Add(this.label1);
            base.Controls.Add(this.cbb_appName);
            base.Icon = (Icon) resources.GetObject("$this.Icon");
            base.Name = "frmAddExploit";
            this.Text = "EXP按钮属性配置";
            base.Load += new EventHandler(this.frmAddExploit_Load);
            base.ResumeLayout(false);
            base.PerformLayout();
        }

        public void K8msgbox(string k8msg)
        {
            MessageBox.Show(this, k8msg, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Asterisk);
        }

        public void K8msgbox(string TipTitle, string k8msg)
        {
            MessageBox.Show(this, k8msg, TipTitle, MessageBoxButtons.OK, MessageBoxIcon.Asterisk);
        }

        private void LoadExpAppList()
        {
            this.cbb_appName.Items.Clear();
            DataSet appNameDataSet = BLLk8EXP.GetAppNameDataSet();
            this.cbb_appName.DataSource = appNameDataSet.Tables[0];
            this.cbb_appName.DisplayMember = "appName";
            this.cbb_appName.Text = "";
        }
    }
}

